<meta>
 
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 
 <title>
  PokeMMO Team &amp; Project Hub
 </title>
 <script src="https://cdn.tailwindcss.com">
 </script>
 <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap" rel="stylesheet">
 <script type="module">
  // Firebase App (the core)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, onSnapshot, collection, addDoc, deleteDoc, updateDoc, arrayRemove, arrayUnion, query, orderBy, writeBatch, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        // --- Your web app's Firebase configuration ---
        const firebaseConfig = {
            apiKey: "AIzaSyDsacPQOqciPdM5SLHMh0muDH9GXswnyU0",
            authDomain: "pokemmo-team.firebaseapp.com",
            projectId: "pokemmo-team",
            storageBucket: "pokemmo-team.appspot.com",
            messagingSenderId: "538474033829",
            appId: "1:538474033829:web:26b62ba96efa1901ead34c",
            measurementId: "G-HWFL88XH7H"
        };
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        // --- App State ---
        let currentUserId = null;
        let currentUsername = null;
        let currentUserRole = 'Guest';
        let currentHubId = null;
        let hubPermissions = {};
        let unsubscribeListeners = [];
        const usernameCache = {};
        const SUPERADMIN_UID = "G9MP7oe0cTQsu92SEXB6wqy1nQs1";
        // --- DOM Elements ---
        const authContainer = document.getElementById('auth-container');
        const appContainer = document.getElementById('app-container');
        const hubIdDisplay = document.getElementById('hub-id-display');
        const hubIdInput = document.getElementById('hub-id-input');
        const changeHubBtn = document.getElementById('change-hub-btn');
        const createHubBtn = document.getElementById('create-hub-btn');
        const mainContent = document.getElementById('main-content');
        const loadingOverlay = document.getElementById('loading-overlay');
        const navButtons = document.querySelectorAll('.nav-button');
        const modal = document.getElementById('modal');
        const modalMessage = document.getElementById('modal-message');
        const modalConfirmBtn = document.getElementById('modal-confirm-btn');
        const modalCancelBtn = document.getElementById('modal-cancel-btn');
        const userProfileDisplay = document.getElementById('user-profile-display');
        const logoutBtn = document.getElementById('logout-btn');
        const genericModal = document.getElementById('generic-modal');
        const genericModalTitle = document.getElementById('generic-modal-title');
        const genericModalContent = document.getElementById('generic-modal-content');
        const genericModalCloseBtn = document.getElementById('generic-modal-close-btn');
        // --- Core Functions ---
        function showLoading(show) { loadingOverlay.style.display = show ? 'flex' : 'none'; }
        function showModal(message, onConfirm) { modalMessage.textContent = message; modal.classList.remove('hidden'); modalConfirmBtn.onclick = () => { onConfirm(); hideModal(); }; }
        function hideModal() { modal.classList.add('hidden'); modalConfirmBtn.onclick = null; }
        modalCancelBtn.addEventListener('click', hideModal);
        function showGenericModal(title, content, formSubmitHandler = null) {
            genericModalTitle.textContent = title;
            genericModalContent.innerHTML = content;
            genericModal.classList.remove('hidden');
            const form = genericModalContent.querySelector('form');
            if (form) {
                form.onsubmit = (e) => {
                    e.preventDefault();
                    if(formSubmitHandler) formSubmitHandler(e);
                    genericModal.classList.add('hidden');
                };
            }
        }
        genericModalCloseBtn.addEventListener('click', () => genericModal.classList.add('hidden'));
        function checkPermission(action) {
            if (currentUserRole === 'Superadmin') return true;
            return hubPermissions[currentUserRole]?.[action] === true;
        }
        async function getUsername(userId) {
            if (!userId) return "Unknown";
            if (usernameCache[userId]) return usernameCache[userId];
            try {
                const userRef = doc(db, "users", userId);
                const userSnap = await getDoc(userRef);
                if (userSnap.exists()) { const username = userSnap.data().username; usernameCache[userId] = username; return username; }
            } catch (error) { console.error("Error fetching username:", error); }
            return "Anonymous";
        }
        async function seedDefaultResources(hubId) {
            const batch = writeBatch(db);
            const pokedexRef = doc(db, `hubs/${hubId}/resources/pokedex`);
            const moneyRef = doc(db, `hubs/${hubId}/resources/moneyGuide`);
            const evRef = doc(db, `hubs/${hubId}/resources/evHotspots`);
            batch.set(pokedexRef, { entries: { "Garchomp": { name: "Garchomp", stats: "108/130/95/80/85/102", abilities: "Sand Veil, Rough Skin (HA)", builds: [{ name: "Swords Dance", nature: "Jolly", evs: "252 Atk / 4 SpD / 252 Spe", moves: "Swords Dance, Earthquake, Outrage"}] } }});
            batch.set(moneyRef, { entries: [ { id: "gym_reruns", name: 'Gym Rebattles', details: 'Most consistent endgame income.', potential: 'High (~400k/hr)' } ]});
            batch.set(evRef, { entries: [ { id: "hp_marill", stat: 'HP', pokemon: 'Marill (x5)', location: 'Route 114, Hoenn (Surf)', yield: '10' } ]});
            await batch.commit();
        }
        function switchView(viewName) {
            navButtons.forEach(btn => btn.classList.remove('bg-teal-600', 'text-white'));
            const button = document.querySelector(`.nav-button[data-view="${viewName}"]`);
            if (button) button.classList.add('bg-teal-600', 'text-white');
            mainContent.innerHTML = '';
            unsubscribeListeners.forEach(unsub => unsub());
            unsubscribeListeners = [];
            const viewRenderers = { 'dashboard': renderDashboard, 'teams': renderTeams, 'tasks': renderTasks, 'breeding': renderBreedingProjects, 'hunts': renderShinyHunts, 'pokedex': renderPokedex, 'ev-hotspots': renderEvHotspots, 'money-guide': renderMoneyGuide, 'admin-panel': renderAdminPanel };
            if (viewRenderers[viewName]) viewRenderers[viewName]();
        }
        async function setupHub(userId) {
            let hubId = localStorage.getItem('currentHubId');
            if (!hubId) {
                hubId = userId.substring(0, 10);
                const hubRef = doc(db, "hubs", hubId);
                await setDoc(hubRef, {
                    owner: userId,
                    members: [userId],
                    createdAt: serverTimestamp(),
                    permissions: {
                        Admin: { canManageTeam: true, canManageTasks: true, canManageProjects: true, canEditResources: true, canMarkStaffPick: true },
                        Staff: { canManageTasks: true, canManageProjects: true, canMarkStaffPick: true },
                        Member: {}
                    }
                });
                await seedDefaultResources(hubId);
                localStorage.setItem('currentHubId', hubId);
            }
            currentHubId = hubId;
            hubIdDisplay.textContent = currentHubId;
            hubIdInput.value = currentHubId;
            const hubRef = doc(db, "hubs", currentHubId);
            const unsub = onSnapshot(hubRef, async (hubSnap) => {
                if(hubSnap.exists()) {
                    hubPermissions = hubSnap.data().permissions || {};
                    if(!hubSnap.data().members?.includes(userId)) {
                        await updateDoc(hubRef, { members: arrayUnion(userId) });
                    }
                } else {
                    alert("Team Space not found. Creating a new one for you.");
                    localStorage.removeItem('currentHubId');
                    location.reload();
                }
            });
            unsubscribeListeners.push(unsub);
            switchView('dashboard');
        }
        // --- Render Functions ---
        async function renderDashboard() {
            mainContent.innerHTML = `<h2 class="text-3xl font-bold text-gray-800 mb-6">Team Dashboard</h2><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"><div class="bg-white p-6 rounded-lg shadow"><h3 class="font-bold text-xl mb-3">Active Breeding Projects</h3><div id="dashboard-breeding" class="space-y-2"></div></div><div class="bg-white p-6 rounded-lg shadow"><h3 class="font-bold text-xl mb-3">Active Shiny Hunts</h3><div id="dashboard-hunts" class="space-y-2"></div></div><div class="bg-white p-6 rounded-lg shadow"><h3 class="font-bold text-xl mb-3">Team Members</h3><div id="dashboard-members" class="space-y-2"></div></div></div>`;
            const renderList = async (q, containerId, formatter) => {
                const unsub = onSnapshot(q, async (snapshot) => {
                    const container = document.getElementById(containerId);
                    if (!container) return;
                    container.innerHTML = 'Loading...';
                    const items = await Promise.all(snapshot.docs.map(doc => formatter(doc.data(), doc.id)));
                    container.innerHTML = items.length > 0 ? items.join('') : `<p class="text-gray-500">Nothing here yet.</p>`;
                });
                unsubscribeListeners.push(unsub);
            };
            await renderList(query(collection(db, `hubs/${currentHubId}/breeding`), orderBy("createdAt", "desc")), 'dashboard-breeding', async (data) => `<p>${data.targetPokemon} <span class="text-xs text-gray-400">by ${await getUsername(data.createdBy)}</span></p>`);
            await renderList(query(collection(db, `hubs/${currentHubId}/hunts`), orderBy("createdAt", "desc")), 'dashboard-hunts', async (data) => `<div class="flex justify-between"><span>${data.target} <span class="text-xs text-gray-400">by ${await getUsername(data.createdBy)}</span></span><span class="font-mono font-bold">${data.count.toLocaleString()}</span></div>`);
            const hubUnsub = onSnapshot(doc(db, "hubs", currentHubId), async (hubSnap) => {
                const membersContainer = document.getElementById('dashboard-members');
                if (!membersContainer) return;
                if (hubSnap.exists()) {
                    const memberIds = hubSnap.data().members || [];
                    const memberNames = await Promise.all(memberIds.map(id => getUsername(id)));
                    membersContainer.innerHTML = memberNames.map(name => `<p class="text-gray-700">${name}</p>`).join('');
                }
            });
            unsubscribeListeners.push(hubUnsub);
        }
        function renderTeams() {
            mainContent.innerHTML = `<div class="flex justify-between items-center mb-6"><h2 class="text-3xl font-bold text-gray-800">Team Locker</h2><div class="flex gap-4">${checkPermission('canManageTeam') ? `<button id="add-team-btn" class="bg-teal-500 hover:bg-teal-600 text-white font-bold py-2 px-4 rounded-lg">New Team</button>` : ''}</div></div><div class="mb-4 border-b border-gray-200"><nav class="flex space-x-4" id="teams-filter-nav"><button data-filter="all" class="teams-filter-btn py-2 px-4 font-semibold text-gray-500 border-b-2 border-transparent hover:text-teal-600 hover:border-teal-600 active">All Teams</button><button data-filter="staff" class="teams-filter-btn py-2 px-4 font-semibold text-gray-500 border-b-2 border-transparent hover:text-teal-600 hover:border-teal-600">Staff Picks</button><button data-filter="personal" class="teams-filter-btn py-2 px-4 font-semibold text-gray-500 border-b-2 border-transparent hover:text-teal-600 hover:border-teal-600">My Teams</button></nav></div><div id="teams-container" class="space-y-6"></div>`;
            let currentFilter = 'all';
            const renderFilteredTeams = (teams) => {
                const container = document.getElementById('teams-container'); if (!container) return;
                let filteredTeams = teams;
                if (currentFilter === 'staff') filteredTeams = teams.filter(t => t.data().isStaffPick);
                else if (currentFilter === 'personal') filteredTeams = teams.filter(t => t.data().createdBy === currentUserId);
                if(filteredTeams.length === 0) { container.innerHTML = `<p class="text-gray-500 text-center mt-8">No teams match the filter.</p>`; return; }
                Promise.all(filteredTeams.map(renderTeamCard)).then(html => { container.innerHTML = html.join(''); attachTeamCardListeners(); });
            };
            const q = query(collection(db, `hubs/${currentHubId}/teams`), orderBy("createdAt", "desc"));
            const unsub = onSnapshot(q, (snapshot) => renderFilteredTeams(snapshot.docs));
            unsubscribeListeners.push(unsub);
            document.querySelectorAll('.teams-filter-btn').forEach(btn => btn.onclick = (e) => {
                document.querySelectorAll('.teams-filter-btn').forEach(b => b.classList.remove('active', 'text-teal-600', 'border-teal-600'));
                e.target.classList.add('active', 'text-teal-600', 'border-teal-600');
                currentFilter = e.target.dataset.filter;
                onSnapshot(q, (snapshot) => renderFilteredTeams(snapshot.docs));
            });
            if (checkPermission('canManageTeam')) document.getElementById('add-team-btn').onclick = () => {
                showGenericModal('New Team', `<form class="space-y-4"><input type="text" name="name" placeholder="Team Name" class="w-full p-2 border rounded-lg" required><button type="submit" class="w-full bg-teal-500 text-white p-3 rounded-lg font-bold hover:bg-teal-600">Create Team</button></form>`, async (e) => {
                    if(e.target.name.value) await addDoc(collection(db, `hubs/${currentHubId}/teams`), { name: e.target.name.value, pokemon: [], notes: [], createdBy: currentUserId, createdAt: serverTimestamp(), isStaffPick: false });
                });
            };
        }
        async function renderTeamCard(doc) {
            const team = doc.data(); const teamId = doc.id; const creatorName = await getUsername(team.createdBy);
            const pokemonHtml = (await Promise.all((team.pokemon || []).map(async (p, i) => {
                const addedByName = await getUsername(p.addedBy);
                return `<div class="bg-gray-50 p-4 rounded-md border relative">${checkPermission('canManageTeam') ? `<button data-team-id="${teamId}" data-pokemon-index="${i}" class="delete-pokemon-btn absolute top-2 right-2 text-red-400 hover:text-red-600 font-bold text-xl">&times;</button>`:''}<p class="font-bold text-lg">${p.species}</p><p class="text-sm"><strong>Nature:</strong> ${p.nature}</p><p class="text-sm"><strong>EVs:</strong> ${p.evs}</p><p class="text-sm"><strong>Moves:</strong> ${p.moves.join(', ')}</p><p class="text-xs text-gray-400 mt-2">Added by ${addedByName}</p></div>`;
            }))).join('');
            const notesHtml = (team.notes || []).map(note => `<div class="text-sm bg-gray-100 p-2 rounded"><strong>${note.authorUsername || '...'}</strong>: ${note.text}</div>`).join('');
            return `<div class="bg-white p-6 rounded-lg shadow"><div class="flex justify-between items-start mb-4"><div><h3 class="text-2xl font-bold">${team.name}</h3><p class="text-sm text-gray-500">Created by ${creatorName}</p></div><div class="flex items-center gap-4">${checkPermission('canMarkStaffPick') ? `<label class="flex items-center gap-2 text-sm"><input type="checkbox" data-team-id="${teamId}" class="staff-pick-checkbox" ${team.isStaffPick ? 'checked' : ''}> Staff Pick</label>` : ''}${checkPermission('canManageTeam') ? `<button data-team-id="${teamId}" class="delete-team-btn text-red-500 hover:text-red-700">Delete Team</button>` : ''}</div></div><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">${pokemonHtml}${team.pokemon.length < 6 && checkPermission('canManageTeam') ? `<button data-team-id="${teamId}" class="add-pokemon-btn flex items-center justify-center bg-gray-200 hover:bg-gray-300 text-gray-600 font-bold p-3 rounded-md transition">+</button>` : ''}</div><div class="border-t pt-4"><h4 class="font-semibold mb-2">Notes</h4><div class="space-y-2 max-h-40 overflow-y-auto mb-2 pr-2">${notesHtml}</div><div class="flex gap-2"><input type="text" data-team-id="${teamId}" class="note-input flex-grow border rounded p-2" placeholder="Add a note..."><button data-team-id="${teamId}" class="add-note-btn bg-gray-600 text-white px-4 rounded-lg">Post</button></div></div></div>`;
        }
        function attachTeamCardListeners() {
            document.querySelectorAll('.add-pokemon-btn').forEach(btn => btn.onclick = e => {
                const teamId = e.target.dataset.teamId;
                const formHtml = `<form class="space-y-4"><input type="text" name="species" placeholder="Species" class="w-full p-2 border rounded-lg" required><input type="text" name="nature" placeholder="Nature" class="w-full p-2 border rounded-lg"><input type="text" name="evs" placeholder="EVs (e.g., 252 Atk / 252 Spe)" class="w-full p-2 border rounded-lg"><input type="text" name="moves" placeholder="Moves (comma-separated)" class="w-full p-2 border rounded-lg"><div class="flex justify-end gap-4 pt-4"><button type="button" class="generic-modal-close-btn bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-6 rounded-lg">Cancel</button><button type="submit" class="bg-teal-500 hover:bg-teal-600 text-white font-bold py-2 px-6 rounded-lg">Add Pokémon</button></div></form>`;
                showGenericModal('Add Pokémon to Team', formHtml, async (event) => {
                    const { species, nature, evs, moves } = event.target;
                    if(species.value) await updateDoc(doc(db, `hubs/${currentHubId}/teams`, teamId), { pokemon: arrayUnion({ species: species.value, nature: nature.value, evs: evs.value, moves: moves.value.split(',').map(m => m.trim()), addedBy: currentUserId }) });
                });
                document.querySelector('.generic-modal-close-btn').onclick = () => genericModal.classList.add('hidden');
            });
            document.querySelectorAll('.add-note-btn').forEach(btn => btn.onclick = async e => {
                const teamId = e.target.dataset.teamId;
                const input = document.querySelector(`.note-input[data-team-id="${teamId}"]`);
                if (input.value.trim()) { await updateDoc(doc(db, `hubs/${currentHubId}/teams`, teamId), { notes: arrayUnion({ text: input.value, authorId: currentUserId, authorUsername: currentUsername, createdAt: serverTimestamp() }) }); input.value = ''; }
            });
            document.querySelectorAll('.delete-team-btn').forEach(btn => btn.onclick = e => showModal('Delete this entire team?', () => deleteDoc(doc(db, `hubs/${currentHubId}/teams`, e.target.dataset.teamId))));
            document.querySelectorAll('.delete-pokemon-btn').forEach(btn => btn.onclick = async e => {
                const { teamId, pokemonIndex } = e.target.dataset;
                const teamRef = doc(db, `hubs/${currentHubId}/teams`, teamId); const teamSnap = await getDoc(teamRef); const pokemonToRemove = teamSnap.data().pokemon[pokemonIndex];
                showModal(`Delete ${pokemonToRemove.species}?`, () => updateDoc(teamRef, { pokemon: arrayRemove(pokemonToRemove) }));
            });
            document.querySelectorAll('.staff-pick-checkbox').forEach(box => box.onchange = async e => await updateDoc(doc(db, `hubs/${currentHubId}/teams`, e.target.dataset.teamId), { isStaffPick: e.target.checked }));
        }
        function renderTasks() {
            mainContent.innerHTML = `<div class="flex justify-between items-center mb-6"><h2 class="text-3xl font-bold text-gray-800">Task Board</h2></div><div class="mb-4 border-b border-gray-200"><nav class="flex space-x-4" id="tasks-tab-nav"><button data-tab="shared" class="tasks-tab-btn py-2 px-4 font-semibold text-teal-600 border-b-2 border-teal-600">Shared Tasks</button><button data-tab="personal" class="tasks-tab-btn py-2 px-4 font-semibold text-gray-500 border-b-2 border-transparent">My Tasks</button></nav></div><div id="tasks-content"></div>`;
            const renderTabContent = (tab) => {
                const container = document.getElementById('tasks-content');
                if (tab === 'shared') {
                    container.innerHTML = `${checkPermission('canManageTasks') ? `<div class="bg-white p-6 rounded-lg shadow mb-6"><form id="add-task-form" class="flex gap-4"><input type="text" name="taskText" placeholder="New shared task..." class="flex-grow p-2 border rounded-lg" required><button type="submit" class="bg-teal-500 hover:bg-teal-600 text-white font-bold py-2 px-4 rounded-lg">Add Task</button></form></div>` : ''}<div id="shared-tasks-container" class="space-y-4"></div>`;
                    if (checkPermission('canManageTasks')) document.getElementById('add-task-form').onsubmit = async e => { e.preventDefault(); const text = e.target.taskText.value; if(text) await addDoc(collection(db, `hubs/${currentHubId}/tasks`), { text, completed: false, createdBy: currentUserId, createdAt: serverTimestamp() }); e.target.reset(); };
                    const q = query(collection(db, `hubs/${currentHubId}/tasks`), orderBy("createdAt", "desc"));
                    const unsub = onSnapshot(q, async (snapshot) => {
                        const taskContainer = document.getElementById('shared-tasks-container'); if (!taskContainer) return;
                        taskContainer.innerHTML = snapshot.empty ? '<p class="text-gray-500 text-center mt-8">No shared tasks.</p>' : (await Promise.all(snapshot.docs.map(async doc => {
                            const task = doc.data(); const taskId = doc.id; const creatorName = await getUsername(task.createdBy);
                            return `<div class="bg-white p-4 rounded-lg shadow flex items-center justify-between"><div class="flex items-center gap-4"><input type="checkbox" data-task-id="${taskId}" class="task-checkbox h-6 w-6" ${task.completed ? 'checked' : ''}><p class="${task.completed ? 'line-through text-gray-400' : ''}">${task.text}</p></div><div class="text-right"><p class="text-sm text-gray-500">Added by ${creatorName}</p>${checkPermission('canManageTasks') ? `<button data-task-id="${taskId}" class="delete-task-btn text-xs text-red-500 hover:underline">Delete</button>` : ''}</div></div>`;
                        }))).join('');
                        document.querySelectorAll('.task-checkbox').forEach(el => el.onchange = async e => await updateDoc(doc(db, `hubs/${currentHubId}/tasks`, e.target.dataset.taskId), { completed: e.target.checked }));
                        if (checkPermission('canManageTasks')) document.querySelectorAll('.delete-task-btn').forEach(btn => btn.onclick = e => showModal('Delete this task?', () => deleteDoc(doc(db, `hubs/${currentHubId}/tasks`, e.target.dataset.taskId))));
                    });
                    unsubscribeListeners.push(unsub);
                } else { // Personal tasks
                    container.innerHTML = `<div class="bg-white p-6 rounded-lg shadow mb-6"><form id="add-personal-task-form" class="flex gap-4"><input type="text" name="taskText" placeholder="New personal task..." class="flex-grow p-2 border rounded-lg" required><button type="submit" class="bg-teal-500 hover:bg-teal-600 text-white font-bold py-2 px-4 rounded-lg">Add Task</button></form></div><div id="personal-tasks-container" class="space-y-4"></div>`;
                    document.getElementById('add-personal-task-form').onsubmit = async e => { e.preventDefault(); const text = e.target.taskText.value; if(text) await addDoc(collection(db, `users/${currentUserId}/tasks`), { text, completed: false, createdAt: serverTimestamp() }); e.target.reset(); };
                    const q = query(collection(db, `users/${currentUserId}/tasks`), orderBy("createdAt", "desc"));
                    const unsub = onSnapshot(q, (snapshot) => {
                        const taskContainer = document.getElementById('personal-tasks-container'); if (!taskContainer) return;
                        taskContainer.innerHTML = snapshot.empty ? '<p class="text-gray-500 text-center mt-8">No personal tasks.</p>' : snapshot.docs.map(doc => {
                            const task = doc.data(); const taskId = doc.id;
                            return `<div class="bg-white p-4 rounded-lg shadow flex items-center justify-between"><div class="flex items-center gap-4"><input type="checkbox" data-task-id="${taskId}" class="personal-task-checkbox h-6 w-6" ${task.completed ? 'checked' : ''}><p class="${task.completed ? 'line-through text-gray-400' : ''}">${task.text}</p></div><button data-task-id="${taskId}" class="delete-personal-task-btn text-xs text-red-500 hover:underline">Delete</button></div>`;
                        }).join('');
                        document.querySelectorAll('.personal-task-checkbox').forEach(el => el.onchange = async e => await updateDoc(doc(db, `users/${currentUserId}/tasks`, e.target.dataset.taskId), { completed: e.target.checked }));
                        document.querySelectorAll('.delete-personal-task-btn').forEach(btn => btn.onclick = e => showModal('Delete this task?', () => deleteDoc(doc(db, `users/${currentUserId}/tasks`, e.target.dataset.taskId))));
                    });
                    unsubscribeListeners.push(unsub);
                }
            };
            document.querySelectorAll('.tasks-tab-btn').forEach(btn => btn.onclick = (e) => { document.querySelectorAll('.tasks-tab-btn').forEach(b => b.classList.remove('text-teal-600', 'border-teal-600')); e.target.classList.add('text-teal-600', 'border-teal-600'); renderTabContent(e.target.dataset.tab); });
            renderTabContent('shared');
        }
        function renderBreedingProjects() {
            mainContent.innerHTML = `<div class="flex justify-between items-center mb-6"><h2 class="text-3xl font-bold text-gray-800">Breeding Projects</h2>${checkPermission('canManageProjects') ? `<button id="add-project-btn" class="bg-teal-500 hover:bg-teal-600 text-white font-bold py-2 px-4 rounded-lg">New Project</button>` : ''}</div><div id="projects-container" class="space-y-6"></div>`;
            if (checkPermission('canManageProjects')) {
                document.getElementById('add-project-btn').onclick = () => {
                    const formHtml = `<form class="space-y-4"><input type="text" name="target" placeholder="Target Pokémon" class="w-full p-2 border rounded-lg" required><button type="submit" class="w-full bg-teal-500 text-white p-3 rounded-lg font-bold hover:bg-teal-600">Create Project</button></form>`;
                    showGenericModal('New Breeding Project', formHtml, async (e) => {
                        const target = e.target.target.value;
                        if(target) await addDoc(collection(db, `hubs/${currentHubId}/breeding`), { targetPokemon: target, steps: [{name: 'Base 1x31', cost: 0, done: false}, {name: 'Base 1x31', cost: 0, done: false}], createdBy: currentUserId, createdAt: serverTimestamp() });
                    });
                };
            }
            const q = query(collection(db, `hubs/${currentHubId}/breeding`), orderBy("createdAt", "desc"));
            const unsub = onSnapshot(q, async (snapshot) => {
                const container = document.getElementById('projects-container'); if (!container) return;
                container.innerHTML = snapshot.empty ? '<p class="text-gray-500 text-center mt-8">No breeding projects.</p>' : (await Promise.all(snapshot.docs.map(async doc => {
                    const project = doc.data(); const projectId = doc.id; const creatorName = await getUsername(project.createdBy); const totalCost = project.steps.reduce((acc, step) => acc + (Number(step.cost) || 0), 0);
                    return `<div class="bg-white p-6 rounded-lg shadow"><div class="flex justify-between items-start"><div><h3 class="text-2xl font-bold mb-1">${project.targetPokemon}</h3><p class="text-sm text-gray-500">Created by ${creatorName}</p></div>${checkPermission('canManageProjects') ? `<button data-project-id="${projectId}" class="delete-project-btn text-red-500 hover:text-red-700">Delete</button>`:''}</div><div class="space-y-2 my-4">${project.steps.map((step, i) => `<div class="flex items-center gap-4 p-2 rounded-md ${step.done ? 'bg-green-100' : 'bg-gray-50'}"><input type="checkbox" data-project-id="${projectId}" data-step-index="${i}" class="step-checkbox h-5 w-5" ${step.done ? 'checked' : ''}><input type="text" value="${step.name}" class="step-name-input flex-grow bg-transparent p-1 rounded" data-project-id="${projectId}" data-step-index="${i}"><input type="number" value="${step.cost}" class="step-cost-input w-24 bg-transparent p-1 rounded" placeholder="Cost" data-project-id="${projectId}" data-step-index="${i}"></div>`).join('')}</div><div class="mt-4 flex justify-between items-center">${checkPermission('canManageProjects') ? `<button data-project-id="${projectId}" class="add-step-btn text-teal-600 hover:text-teal-800 font-semibold">Add Step</button>`:''}<p class="font-bold text-xl">Total: ${totalCost.toLocaleString()} ¥</p></div></div>`;
                }))).join('');
                if (checkPermission('canManageProjects')) {
                    document.querySelectorAll('.add-step-btn').forEach(btn => btn.onclick = async e => await updateDoc(doc(db, `hubs/${currentHubId}/breeding`, e.target.dataset.projectId), { steps: arrayUnion({name: 'New Step', cost: 0, done: false}) }));
                    document.querySelectorAll('.delete-project-btn').forEach(btn => btn.onclick = e => showModal('Delete this project?', () => deleteDoc(doc(db, `hubs/${currentHubId}/breeding`, e.target.dataset.projectId))));
                    const updateStep = async (projectId, stepIndex, field, value) => { const ref = doc(db, `hubs/${currentHubId}/breeding`, projectId); const snap = await getDoc(ref); const steps = snap.data().steps; steps[stepIndex][field] = value; await updateDoc(ref, { steps }); };
                    document.querySelectorAll('.step-checkbox').forEach(el => el.onchange = e => updateStep(e.target.dataset.projectId, e.target.dataset.stepIndex, 'done', e.target.checked));
                    document.querySelectorAll('.step-name-input').forEach(el => el.onblur = e => updateStep(e.target.dataset.projectId, e.target.dataset.stepIndex, 'name', e.target.value));
                    document.querySelectorAll('.step-cost-input').forEach(el => el.onblur = e => updateStep(e.target.dataset.projectId, e.target.dataset.stepIndex, 'cost', Number(e.target.value)));
                }
            });
            unsubscribeListeners.push(unsub);
        }
        function renderShinyHunts() {
             mainContent.innerHTML = `<div class="flex justify-between items-center mb-6"><h2 class="text-3xl font-bold text-gray-800">Shiny Hunts</h2>${checkPermission('canManageProjects') ? `<button id="add-hunt-btn" class="bg-teal-500 hover:bg-teal-600 text-white font-bold py-2 px-4 rounded-lg">New Hunt</button>` : ''}</div><div id="hunts-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>`;
            if (checkPermission('canManageProjects')) {
                document.getElementById('add-hunt-btn').onclick = () => {
                    const formHtml = `<form class="space-y-4"><input type="text" name="target" placeholder="Target Pokémon" class="w-full p-2 border rounded-lg" required><button type="submit" class="w-full bg-teal-500 text-white p-3 rounded-lg font-bold hover:bg-teal-600">Start Hunt</button></form>`;
                    showGenericModal('New Shiny Hunt', formHtml, async (e) => {
                        const target = e.target.target.value;
                        if(target) await addDoc(collection(db, `hubs/${currentHubId}/hunts`), { target, count: 0, createdBy: currentUserId, createdAt: serverTimestamp() });
                    });
                };
            }
            const q = query(collection(db, `hubs/${currentHubId}/hunts`), orderBy("createdAt", "desc"));
            const unsub = onSnapshot(q, async (snapshot) => {
                const container = document.getElementById('hunts-container'); if (!container) return;
                container.innerHTML = snapshot.empty ? '<p class="text-gray-500 text-center mt-8 col-span-full">No shiny hunts started.</p>' : (await Promise.all(snapshot.docs.map(async doc => {
                    const hunt = doc.data(); const huntId = doc.id; const creatorName = await getUsername(hunt.createdBy); const odds = (hunt.count / 30000 * 100).toFixed(2);
                    return `<div class="bg-white p-6 rounded-lg shadow text-center relative">${checkPermission('canManageProjects') ? `<button data-hunt-id="${huntId}" class="delete-hunt-btn absolute top-2 right-2 text-red-400 hover:text-red-600 font-bold text-xl">&times;</button>`:''}<h3 class="text-2xl font-bold">${hunt.target}</h3><p class="text-sm text-gray-500 mb-2">Tracked by ${creatorName}</p><p class="text-5xl font-mono font-bold my-4">${hunt.count.toLocaleString()}</p><div class="w-full bg-gray-200 rounded-full h-2.5 mb-4"><div class="bg-yellow-400 h-2.5 rounded-full" style="width: ${Math.min(odds, 100)}%"></div></div><p class="text-sm text-gray-500">Odds: 1 in 30,000 (${odds}%)</p><div class="mt-4 flex gap-2"><button data-hunt-id="${huntId}" data-amount="1" class="inc-hunt-btn flex-grow bg-gray-200 hover:bg-gray-300 font-bold py-2 px-4 rounded">+1</button><button data-hunt-id="${huntId}" data-amount="5" class="inc-hunt-btn flex-grow bg-gray-200 hover:bg-gray-300 font-bold py-2 px-4 rounded">+5</button></div></div>`;
                }))).join('');
                document.querySelectorAll('.inc-hunt-btn').forEach(btn => btn.onclick = async e => { const ref = doc(db, `hubs/${currentHubId}/hunts`, e.target.dataset.huntId); const snap = await getDoc(ref); await updateDoc(ref, { count: (snap.data().count || 0) + Number(e.target.dataset.amount) }); });
                if (checkPermission('canManageProjects')) {
                    document.querySelectorAll('.delete-hunt-btn').forEach(btn => btn.onclick = e => showModal('Delete this hunt?', () => deleteDoc(doc(db, `hubs/${currentHubId}/hunts`, e.target.dataset.huntId))));
                }
            });
            unsubscribeListeners.push(unsub);
        }
        async function renderPokedex() {
            mainContent.innerHTML = `<div class="flex justify-between items-center mb-6"><h2 class="text-3xl font-bold text-gray-800">Pokédex & Builds</h2>${checkPermission('canEditResources') ? `<button id="add-pokedex-entry-btn" class="bg-teal-500 hover:bg-teal-600 text-white font-bold py-2 px-4 rounded-lg">Add/Edit Entry</button>` : ''}</div><input id="pokedex-search" type="text" placeholder="Search for a Pokémon..." class="w-full p-3 rounded-lg border shadow-sm mb-6"><div id="pokedex-results" class="space-y-4"></div>`;
            const searchInput = document.getElementById('pokedex-search');
            const resultsContainer = document.getElementById('pokedex-results');
            let pokedexData = {};
            const unsub = onSnapshot(doc(db, `hubs/${currentHubId}/resources/pokedex`), (docSnap) => {
                if (docSnap.exists()) {
                    pokedexData = docSnap.data().entries || {};
                    displayResults(searchInput.value);
                }
            });
            unsubscribeListeners.push(unsub);
            const displayResults = (query) => {
                const filtered = Object.keys(pokedexData).filter(name => name.toLowerCase().includes(query.toLowerCase()));
                resultsContainer.innerHTML = filtered.length === 0 ? '<p>No results found.</p>' : filtered.map(name => { const data = pokedexData[name]; return `<div class="bg-white p-4 rounded-lg shadow"><h3 class="text-xl font-bold">${name}</h3><div class="text-sm text-gray-600 mb-3"><p><strong>Base Stats:</strong> ${data.stats}</p><p><strong>Abilities:</strong> ${data.abilities}</p></div>${(data.builds || []).map(build => `<div class="border-t pt-3 mt-3"><h4 class="font-bold text-teal-700">${build.name}</h4><p class="text-sm"><strong>Nature:</strong> ${build.nature}</p><p class="text-sm"><strong>EVs:</strong> ${build.evs}</p><p class="text-sm"><strong>Moves:</strong> ${build.moves}</p></div>`).join('')}</div>`; }).join('');
            };
            searchInput.addEventListener('input', (e) => displayResults(e.target.value));
            if (checkPermission('canEditResources')) document.getElementById('add-pokedex-entry-btn').onclick = () => {
                const formHtml = `<form class="space-y-4"><input type="text" name="name" placeholder="Pokémon Name (e.g., Garchomp)" class="w-full p-2 border rounded-lg" required><input type="text" name="stats" placeholder="Base Stats (e.g., 108/130/95/80/85/102)" class="w-full p-2 border rounded-lg"><input type="text" name="abilities" placeholder="Abilities (e.g., Sand Veil, Rough Skin (HA))" class="w-full p-2 border rounded-lg"><textarea name="builds" placeholder='Builds in JSON format: [{"name":"Build Name", "nature":"Jolly", ...}]' class="w-full p-2 border rounded-lg h-32"></textarea><button type="submit" class="w-full bg-teal-500 text-white p-3 rounded-lg font-bold hover:bg-teal-600">Save Entry</button></form>`;
                showGenericModal('Add/Edit Pokédex Entry', formHtml, async (e) => {
                    const { name, stats, abilities, builds } = e.target;
                    try {
                        const buildsParsed = builds.value ? JSON.parse(builds.value) : [];
                        const entryPath = `entries.${name.value.trim()}`;
                        await updateDoc(doc(db, `hubs/${currentHubId}/resources/pokedex`), { [entryPath]: { name: name.value.trim(), stats: stats.value, abilities: abilities.value, builds: buildsParsed } });
                        alert("Pokédex entry saved!");
                    } catch (err) { alert("Error saving entry. Make sure builds are in valid JSON format."); console.error(err); }
                });
            };
        }
        async function renderEvHotspots() {
            mainContent.innerHTML = `<div class="flex justify-between items-center mb-6"><h2 class="text-3xl font-bold text-gray-800">EV Training Hotspots</h2>${checkPermission('canEditResources') ? `<button id="add-ev-hotspot-btn" class="bg-teal-500 hover:bg-teal-600 text-white font-bold py-2 px-4 rounded-lg">Add/Edit Hotspot</button>` : ''}</div><div id="ev-hotspots-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>`;
            const unsub = onSnapshot(doc(db, `hubs/${currentHubId}/resources/evHotspots`), (docSnap) => {
                const container = document.getElementById('ev-hotspots-container'); if (!container) return;
                if (docSnap.exists()) {
                    const entries = docSnap.data().entries || [];
                    container.innerHTML = entries.map(d => `<div class="bg-white p-6 rounded-lg shadow"><h3 class="text-xl font-bold text-teal-700">${d.stat}</h3><p class="font-semibold">${d.pokemon}</p><p class="text-gray-600">${d.location}</p><p class="text-sm mt-2">Yield: ${d.yield} EVs per horde</p></div>`).join('');
                }
            });
            unsubscribeListeners.push(unsub);
            if (checkPermission('canEditResources')) document.getElementById('add-ev-hotspot-btn').onclick = () => {
                const formHtml = `<form class="space-y-4"><input type="text" name="id" placeholder="Unique ID (e.g., hp_marill)" class="w-full p-2 border rounded-lg" required><input type="text" name="stat" placeholder="Stat (e.g., HP)" class="w-full p-2 border rounded-lg" required><input type="text" name="pokemon" placeholder="Pokémon Horde (e.g., Marill (x5))" class="w-full p-2 border rounded-lg"><input type="text" name="location" placeholder="Location" class="w-full p-2 border rounded-lg"><input type="text" name="yield" placeholder="EV Yield" class="w-full p-2 border rounded-lg"><button type="submit" class="w-full bg-teal-500 text-white p-3 rounded-lg font-bold hover:bg-teal-600">Save Hotspot</button></form>`;
                showGenericModal('Add/Edit EV Hotspot', formHtml, async (e) => {
                    const { id, stat, pokemon, location, yield: evYield } = e.target;
                    const hotspotRef = doc(db, `hubs/${currentHubId}/resources/evHotspots`);
                    const docSnap = await getDoc(hotspotRef);
                    const entries = docSnap.data().entries || [];
                    const newEntry = { id: id.value, stat: stat.value, pokemon: pokemon.value, location: location.value, yield: evYield.value };
                    const existingIndex = entries.findIndex(entry => entry.id === id.value);
                    if (existingIndex > -1) entries[existingIndex] = newEntry;
                    else entries.push(newEntry);
                    await updateDoc(hotspotRef, { entries });
                    alert("EV Hotspot saved!");
                });
            };
        }
        async function renderMoneyGuide() {
            mainContent.innerHTML = `<div class="flex justify-between items-center mb-6"><h2 class="text-3xl font-bold text-gray-800">Money Making Guide</h2>${checkPermission('canEditResources') ? `<button id="add-money-guide-btn" class="bg-teal-500 hover:bg-teal-600 text-white font-bold py-2 px-4 rounded-lg">Add/Edit Guide</button>` : ''}</div><div id="money-guide-container" class="space-y-4"></div>`;
            const unsub = onSnapshot(doc(db, `hubs/${currentHubId}/resources/moneyGuide`), (docSnap) => {
                const container = document.getElementById('money-guide-container'); if (!container) return;
                if (docSnap.exists()) {
                    const entries = docSnap.data().entries || [];
                    container.innerHTML = entries.map(d => `<div class="bg-white p-6 rounded-lg shadow"><h3 class="text-xl font-bold">${d.name}</h3><p class="text-gray-600 my-2">${d.details}</p><p class="font-semibold text-teal-600">Potential: ${d.potential}</p></div>`).join('');
                }
            });
            unsubscribeListeners.push(unsub);
            if (checkPermission('canEditResources')) document.getElementById('add-money-guide-btn').onclick = () => {
                const formHtml = `<form class="space-y-4"><input type="text" name="id" placeholder="Unique ID (e.g., gym_reruns)" class="w-full p-2 border rounded-lg" required><input type="text" name="name" placeholder="Method Name" class="w-full p-2 border rounded-lg" required><input type="text" name="details" placeholder="Details" class="w-full p-2 border rounded-lg"><input type="text" name="potential" placeholder="Potential (e.g., High (~400k/hr))" class="w-full p-2 border rounded-lg"><button type="submit" class="w-full bg-teal-500 text-white p-3 rounded-lg font-bold hover:bg-teal-600">Save Guide</button></form>`;
                showGenericModal('Add/Edit Money Guide', formHtml, async (e) => {
                    const { id, name, details, potential } = e.target;
                    const guideRef = doc(db, `hubs/${currentHubId}/resources/moneyGuide`);
                    const docSnap = await getDoc(guideRef);
                    const entries = docSnap.data().entries || [];
                    const newEntry = { id: id.value, name: name.value, details: details.value, potential: potential.value };
                    const existingIndex = entries.findIndex(entry => entry.id === id.value);
                    if (existingIndex > -1) entries[existingIndex] = newEntry;
                    else entries.push(newEntry);
                    await updateDoc(guideRef, { entries });
                    alert("Money guide saved!");
                });
            };
        }
        async function renderAdminPanel() {
            if (currentUserRole !== 'Superadmin') { mainContent.innerHTML = `<p class="text-red-500">Access Denied.</p>`; return; }
            mainContent.innerHTML = `<h2 class="text-3xl font-bold text-gray-800 mb-6">Admin Panel</h2><div class="grid grid-cols-1 lg:grid-cols-2 gap-8"><div class="bg-white p-6 rounded-lg shadow"><h3 class="text-xl font-bold mb-4">User Role Management</h3><div id="user-roles-container" class="space-y-3">Loading...</div></div><div class="bg-white p-6 rounded-lg shadow"><h3 class="text-xl font-bold mb-4">Team Permission Settings</h3><div id="permissions-container" class="space-y-4"></div><button id="save-perms-btn" class="mt-6 w-full bg-teal-500 text-white p-3 rounded-lg font-bold hover:bg-teal-600">Save Permissions</button></div></div>`;
            const hubRef = doc(db, "hubs", currentHubId); const hubSnap = await getDoc(hubRef); const memberIds = hubSnap.data().members || [];
            const usersHtml = await Promise.all(memberIds.map(async (uid) => {
                const userDoc = await getDoc(doc(db, "users", uid)); if (!userDoc.exists()) return ''; const { username, role } = userDoc.data();
                if (uid === SUPERADMIN_UID) return `<div class="flex justify-between items-center"><p>${username} <span class="text-xs font-bold text-yellow-500">Superadmin</span></p></div>`;
                return `<div class="flex justify-between items-center"><p>${username}</p><select data-uid="${uid}" class="role-selector p-1 border rounded"><option value="Member" ${role === 'Member' ? 'selected' : ''}>Member</option><option value="Staff" ${role === 'Staff' ? 'selected' : ''}>Staff</option><option value="Admin" ${role === 'Admin' ? 'selected' : ''}>Admin</option></select></div>`;
            }));
            document.getElementById('user-roles-container').innerHTML = usersHtml.join('');
            document.querySelectorAll('.role-selector').forEach(sel => { sel.onchange = async (e) => await updateDoc(doc(db, "users", e.target.dataset.uid), { role: e.target.value }); });
            const permsContainer = document.getElementById('permissions-container');
            const rolesToManage = ['Admin', 'Staff', 'Member'];
            const actions = { canManageTeam: "Manage Teams", canManageProjects: "Manage Projects", canManageTasks: "Manage Shared Tasks", canEditResources: "Edit Resources", canMarkStaffPick: "Mark Staff Picks" };
            permsContainer.innerHTML = rolesToManage.map(role => `<div class="border p-4 rounded-lg"><h4 class="font-bold text-lg">${role}</h4><div class="space-y-2 mt-2">${Object.entries(actions).map(([key, label]) => `<label class="flex items-center gap-2"><input type="checkbox" data-role="${role}" data-action="${key}" class="perm-checkbox h-4 w-4" ${hubPermissions[role]?.[key] === true ? 'checked' : ''}> ${label}</label>`).join('')}</div></div>`).join('');
            document.getElementById('save-perms-btn').onclick = async () => {
                showLoading(true);
                const newPermissions = {};
                document.querySelectorAll('.perm-checkbox').forEach(box => {
                    const { role, action } = box.dataset;
                    if (!newPermissions[role]) newPermissions[role] = {};
                    newPermissions[role][action] = box.checked;
                });
                try {
                    await updateDoc(doc(db, "hubs", currentHubId), { permissions: newPermissions });
                    hubPermissions = newPermissions; // Update local state
                    alert("Permissions saved successfully!");
                } catch (error) {
                    alert("Error saving permissions: " + error.message);
                } finally {
                    showLoading(false);
                }
            };
        }
        // --- Event Listeners ---
        onAuthStateChanged(auth, async (user) => {
            try {
                showLoading(true);
                if (user) {
                    currentUserId = user.uid;
                    const userRef = doc(db, "users", currentUserId);
                    const userSnap = await getDoc(userRef);
                    if (userSnap.exists()) {
                        const userData = userSnap.data();
                        currentUsername = userData.username;
                        currentUserRole = user.uid === SUPERADMIN_UID ? 'Superadmin' : userData.role;
                        if (user.uid === SUPERADMIN_UID && userData.role !== 'Superadmin') {
                            await updateDoc(userRef, { role: 'Superadmin' });
                        }
                        userProfileDisplay.textContent = `${currentUsername} (${currentUserRole})`;
                        document.getElementById('admin-panel-btn').style.display = currentUserRole === 'Superadmin' ? 'block' : 'none';
                        authContainer.classList.add('hidden');
                        appContainer.classList.remove('hidden');
                        await setupHub(currentUserId);
                    } else { await signOut(auth); }
                } else {
                    authContainer.classList.remove('hidden');
                    appContainer.classList.add('hidden');
                }
            } catch (error) { console.error("Authentication Error:", error); } 
            finally { showLoading(false); }
        });
        document.getElementById('login-form').onsubmit = async (e) => { e.preventDefault(); showLoading(true); const email = e.target.email.value; const password = e.target.password.value; try { await signInWithEmailAndPassword(auth, email, password); } catch (error) { alert(error.message); } finally { showLoading(false); } };
        document.getElementById('signup-form').onsubmit = async (e) => {
            e.preventDefault(); showLoading(true); const email = e.target.signup_email.value; const password = e.target.signup_password.value; const username = e.target.signup_username.value;
            if (password.length < 6) { alert("Password must be at least 6 characters."); showLoading(false); return; }
            if (username.length < 3) { alert("Username must be at least 3 characters."); showLoading(false); return; }
            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password); const user = userCredential.user;
                let role = user.uid === SUPERADMIN_UID ? 'Superadmin' : 'Member';
                await setDoc(doc(db, "users", user.uid), { username, email, role });
            } catch (error) { alert(error.message); } finally { showLoading(false); }
        };
        logoutBtn.onclick = () => signOut(auth);
        navButtons.forEach(btn => btn.addEventListener('click', () => switchView(btn.dataset.view)));
        changeHubBtn.addEventListener('click', () => { const newHubId = hubIdInput.value.trim(); if (newHubId && newHubId !== currentHubId) { localStorage.setItem('currentHubId', newHubId); location.reload(); } });
        createHubBtn.addEventListener('click', () => { localStorage.removeItem('currentHubId'); location.reload(); });
 </script>
 <style>
  body { font-family: 'Inter', sans-serif; } .tasks-tab-btn.active, .teams-filter-btn.active { color: #0d9488; border-color: #0d9488; }
 </style>
 <div id="loading-overlay" class="hidden fixed inset-0 bg-white bg-opacity-75 flex items-center justify-center z-50">
  <div class="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-teal-500">
  </div>
 </div>
 <div id="auth-container">
  <div class="min-h-screen flex items-center justify-center">
   <div class="max-w-4xl w-full grid md:grid-cols-2 gap-8 p-8">
    <div class="bg-white p-8 rounded-lg shadow-lg">
     <h2 class="text-2xl font-bold text-center mb-6">
      Login
     </h2>
     <form id="login-form" class="space-y-4">
      <input type="email" name="email" placeholder="Email" class="w-full p-3 border rounded-lg" required="">
      <input type="password" name="password" placeholder="Password" class="w-full p-3 border rounded-lg" required="">
      <button type="submit" class="w-full bg-teal-500 text-white p-3 rounded-lg font-bold hover:bg-teal-600">
       Login
      </button>
     </form>
    </div>
    <div class="bg-white p-8 rounded-lg shadow-lg">
     <h2 class="text-2xl font-bold text-center mb-6">
      Sign Up
     </h2>
     <form id="signup-form" class="space-y-4">
      <input type="text" name="signup_username" placeholder="Username" class="w-full p-3 border rounded-lg" required="">
      <input type="email" name="signup_email" placeholder="Email" class="w-full p-3 border rounded-lg" required="">
      <input type="password" name="signup_password" placeholder="Password" class="w-full p-3 border rounded-lg" required="">
      <p class="text-xs text-red-600 text-center">
       Warning: For your security, do NOT use the same password as your PokeMMO game account.
      </p>
      <button type="submit" class="w-full bg-gray-700 text-white p-3 rounded-lg font-bold hover:bg-gray-800">
       Create Account
      </button>
     </form>
    </div>
   </div>
  </div>
 </div>
 <div id="app-container" class="hidden">
  <div id="generic-modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 h-full w-full z-50 flex items-center justify-center">
   <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-2xl mx-auto">
    <div class="flex justify-between items-center mb-4">
     <h3 id="generic-modal-title" class="text-2xl font-bold">
      Modal Title
     </h3>
     <button id="generic-modal-close-btn" class="text-gray-500 hover:text-gray-800 font-bold text-2xl">
      ×
     </button>
    </div>
    <div id="generic-modal-content" class="max-h-[60vh] overflow-y-auto">
    </div>
   </div>
  </div>
  <div id="modal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 h-full w-full z-50 flex items-center justify-center">
   <div class="bg-white p-8 rounded-lg shadow-xl w-full max-w-md mx-auto">
    <p id="modal-message" class="text-xl mb-6 text-center">
    </p>
    <div class="flex justify-center gap-4">
     <button id="modal-cancel-btn" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-6 rounded-lg">
      Cancel
     </button>
     <button id="modal-confirm-btn" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-6 rounded-lg">
      Confirm
     </button>
    </div>
   </div>
  </div>
  <div class="flex h-screen">
   <aside class="w-64 bg-white shadow-md flex flex-col">
    <div class="p-6 text-center border-b">
     <h1 class="text-2xl font-bold text-teal-700">
      PokeMMO Hub
     </h1>
    </div>
    <nav class="flex-grow p-4 space-y-2">
     <button data-view="dashboard" class="nav-button w-full text-left font-semibold px-4 py-2 rounded-lg hover:bg-gray-100 transition">
      Dashboard
     </button>
     <button data-view="teams" class="nav-button w-full text-left font-semibold px-4 py-2 rounded-lg hover:bg-gray-100 transition">
      Team Locker
     </button>
     <button data-view="tasks" class="nav-button w-full text-left font-semibold px-4 py-2 rounded-lg hover:bg-gray-100 transition">
      Task Board
     </button>
     <button data-view="breeding" class="nav-button w-full text-left font-semibold px-4 py-2 rounded-lg hover:bg-gray-100 transition">
      Breeding Projects
     </button>
     <button data-view="hunts" class="nav-button w-full text-left font-semibold px-4 py-2 rounded-lg hover:bg-gray-100 transition">
      Shiny Hunts
     </button>
     <button data-view="pokedex" class="nav-button w-full text-left font-semibold px-4 py-2 rounded-lg hover:bg-gray-100 transition">
      Pokédex &amp; Builds
     </button>
     <button data-view="ev-hotspots" class="nav-button w-full text-left font-semibold px-4 py-2 rounded-lg hover:bg-gray-100 transition">
      EV Hotspots
     </button>
     <button data-view="money-guide" class="nav-button w-full text-left font-semibold px-4 py-2 rounded-lg hover:bg-gray-100 transition">
      Money Guide
     </button>
     <button data-view="admin-panel" id="admin-panel-btn" class="nav-button w-full text-left font-semibold px-4 py-2 rounded-lg hover:bg-gray-100 transition" style="display: none;">
      Admin Panel
     </button>
    </nav>
    <div class="p-4 border-t space-y-3">
     <div id="user-profile-display" class="text-sm text-center text-gray-600 font-semibold">
     </div>
     <button id="logout-btn" class="w-full text-sm text-red-500 hover:underline">
      Logout
     </button>
     <div class="border-t pt-3">
      <h4 class="font-bold mb-2">
       Share &amp; Collaborate
      </h4>
      <p class="text-sm text-gray-600 mb-2">
       Your current Team ID is:
      </p>
      <p id="hub-id-display" class="bg-gray-100 p-2 rounded text-center font-mono break-words">
      </p>
      <input id="hub-id-input" type="text" placeholder="Enter Team ID to join" class="w-full p-2 border rounded mt-3">
      <button id="change-hub-btn" class="w-full bg-teal-500 text-white p-2 rounded mt-2 hover:bg-teal-600">
       Join Team Space
      </button>
      <button id="create-hub-btn" class="w-full text-sm text-gray-500 mt-2 hover:underline">
       Create a New Team Space
      </button>
     </div>
    </div>
   </aside>
   <main class="flex-1 p-8 overflow-y-auto">
    <div id="main-content">
    </div>
   </main>
  </div>
 </div>